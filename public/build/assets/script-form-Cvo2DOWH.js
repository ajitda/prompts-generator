import{a as J,r,j as t,z as l}from"./app-Bqph7Lll.js";import{B as E}from"./createLucideIcon-Dw4Gd7Kx.js";import{L,S as K,i as X}from"./StoryView-DdvP6TP-.js";import{I as z}from"./input-BIDZnuLM.js";import{I as H}from"./IdeaCard-lzx5r4In.js";import{S as D}from"./ScriptView-jgfvgt5i.js";import{S as V}from"./sparkles-Dz23W4Kh.js";import{A as W}from"./arrow-right-DSyGulAr.js";/* empty css            */import"./card-CqNhcMuz.js";import"./arrow-left-sKwnax1s.js";import"./refresh-cw-BZCLyMbQ.js";import"./file-text-e0hZcvG-.js";import"./check-NHFg7LJD.js";import"./copy-BUGnGZtD.js";const de=()=>{const{props:I}=J(),{auth:Y,initialGuestCredits:C,isAuthenticated:h,userCredits:F}=I,u=h?F??0:C??0,[n,a]=r.useState("input"),[y,g]=r.useState(null),[d,x]=r.useState(""),[k,S]=r.useState([]),[f,w]=r.useState(""),[O,j]=r.useState([]),[T,v]=r.useState(""),[B,P]=r.useState("Conversational & Educational"),[o,c]=r.useState(!1),[p,R]=r.useState(null);r.useEffect(()=>{(async()=>{try{const i=await(await X.load()).get();R(i.visitorId)}catch(e){console.error("Error loading FingerprintJS:",e)}})()},[]);const m={"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"","X-Browser-Fingerprint":p},q=async(s,e)=>{const i={"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",...p&&{"X-Browser-Fingerprint":p}};try{await fetch(`/scripts/${s}`,{method:"PUT",headers:i,body:JSON.stringify({idea:e})})}catch(G){console.error("Failed to save ideas:",G),l.error("Failed to save ideas")}},N=async()=>{if(d.trim()){if(u<=0){l.error("You have no generations left. Please sign up for more.");return}console.log(m,"requestHeaders"),c(!0);try{const e=await(await fetch("/scripts/ideas",{method:"POST",headers:m,body:JSON.stringify({keyword:d})})).json();if(e.success)S(e.ideas),g(e.script_id),a("ideas"),q(e.script_id,e.ideas);else throw new Error(e.message)}catch(s){l.error(s.message||"Error")}finally{c(!1)}}},A=async s=>{w(s),c(!0),a("story");try{const i=await(await fetch("/scripts/story",{method:"POST",headers:m,body:JSON.stringify({script_id:y,title:s})})).json();if(i.success)j(i.story);else throw new Error(i.message)}catch(e){l.error(e.message||"Error"),console.log("check error:",e),a("ideas")}finally{c(!1)}},b=async()=>{c(!0),a("script");try{const e=await(await fetch("/scripts/final",{method:"POST",headers:m,body:JSON.stringify({script_id:y})})).json();if(e.success)v(e.script),P(e.tone);else throw new Error(e.message)}catch(s){console.error("Full Error Details:",s),l.error(s.message||"Error"),a("story")}finally{c(!1)}},_=()=>{a("input"),x(""),g(null),S([]),w(""),j([]),v("")};return t.jsx("div",{className:"min-h-screen bg-background",children:t.jsxs("main",{className:"container mx-auto px-6 max-w-3xl",children:[n==="input"&&!o&&t.jsxs("div",{className:"animate-fade-in flex flex-col items-center justify-center min-h-[60vh]",children:[t.jsx("div",{className:"w-16 h-16 rounded-2xl bg-primary/10 flex items-center justify-center mb-8",children:t.jsx(V,{className:"w-8 h-8 text-primary"})}),t.jsx("h1",{className:"text-center mb-4 text-balance text-4xl font-bold",children:"What's your video about?"}),t.jsxs("div",{className:"w-full max-w-lg space-y-4",children:[t.jsx(z,{value:d,onChange:s=>x(s.target.value),placeholder:"e.g., productivity tips for students",className:"text-center text-lg h-14",onKeyDown:s=>s.key==="Enter"&&N()}),t.jsxs(E,{variant:"default",onClick:N,disabled:!d.trim()||u<=0||!p,size:"lg",className:"w-full gap-2",children:["Generate video ideas ",t.jsx(W,{className:"w-4 h-4"})]}),!h&&t.jsxs("p",{className:"text-center text-sm text-muted-foreground",children:["You have ",u," free generations left."]})]})]}),o&&t.jsx(L,{message:n==="input"?"Exploring possibilities...":n==="ideas"?"Crafting your story...":"Writing your script..."}),n==="ideas"&&!o&&t.jsxs("div",{className:"animate-fade-in space-y-8",children:[t.jsx("div",{className:"text-center space-y-3",children:t.jsx("h2",{className:"text-3xl font-semibold",children:"Let's explore a few directions"})}),t.jsx("div",{className:"space-y-3",children:k.map((s,e)=>t.jsx(H,{idea:s,index:e},e))}),t.jsx(E,{variant:"ghost",onClick:_,className:"w-full",children:"â† Try a different topic"})]}),n==="story"&&!o&&t.jsx(K,{selectedIdea:f,story:O,onRegenerate:()=>A(f),onGenerateScript:b,onBack:()=>a("ideas"),isLoading:o}),n==="script"&&!o&&t.jsx(D,{selectedIdea:f,script:T,tone:B,onBack:()=>a("story"),onRegenerate:b,onStartOver:_,isLoading:o})]})})};export{de as default};
